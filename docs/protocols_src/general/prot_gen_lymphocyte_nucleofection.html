<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-11-21">
<meta name="description" content="Unified 4D-Nucleofector protocol for CRISPR–Cas9 RNP delivery into primary mouse T cells, primary mouse NK cells, human CD8 T cells, and NK-92 cells using cell-type–specific buffer and pulse codes.">

<title>4D-Nucleofector CRISPR–Cas9 RNP Delivery to T and NK Cells – Protocol Library</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-167a4993dfeda6e8ce52aaf90a3aabf8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Protocol Library
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Protocol Library</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/buffers/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-droplet" role="img">
</i> 
 <span class="menu-text">Buffers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/general/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-gear" role="img">
</i> 
 <span class="menu-text">General</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/human/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-person" role="img">
</i> 
 <span class="menu-text">Human</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/mouse/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-mouse" role="img">
</i> 
 <span class="menu-text">Mouse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../templates/index.qmd" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-spreadsheet" role="img">
</i> 
 <span class="menu-text">Templates</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#critical-notes-read-before-starting" id="toc-critical-notes-read-before-starting" class="nav-link" data-scroll-target="#critical-notes-read-before-starting">Critical notes (read before starting)</a></li>
  <li><a href="#approximate-timing" id="toc-approximate-timing" class="nav-link" data-scroll-target="#approximate-timing">Approximate timing</a></li>
  <li><a href="#procedure" id="toc-procedure" class="nav-link" data-scroll-target="#procedure">Procedure</a>
  <ul class="collapse">
  <li><a href="#step-1-cell-typespecific-lookup" id="toc-step-1-cell-typespecific-lookup" class="nav-link" data-scroll-target="#step-1-cell-typespecific-lookup">Step 1 – Cell-type–specific lookup</a>
  <ul class="collapse">
  <li><a href="#cell-typespecific-nucleofection-settings" id="toc-cell-typespecific-nucleofection-settings" class="nav-link" data-scroll-target="#cell-typespecific-nucleofection-settings">1.1 Cell-type–specific nucleofection settings</a></li>
  </ul></li>
  <li><a href="#step-2-grna-duplex-and-rnp-preparation" id="toc-step-2-grna-duplex-and-rnp-preparation" class="nav-link" data-scroll-target="#step-2-grna-duplex-and-rnp-preparation">Step 2 – gRNA duplex and RNP preparation</a>
  <ul class="collapse">
  <li><a href="#crrnatracrrna-duplexing" id="toc-crrnatracrrna-duplexing" class="nav-link" data-scroll-target="#crrnatracrrna-duplexing">2.1 crRNA:tracrRNA duplexing</a></li>
  <li><a href="#rnp-assembly" id="toc-rnp-assembly" class="nav-link" data-scroll-target="#rnp-assembly">2.2 RNP assembly</a></li>
  </ul></li>
  <li><a href="#step-3-cell-preparation" id="toc-step-3-cell-preparation" class="nav-link" data-scroll-target="#step-3-cell-preparation">Step 3 – Cell preparation</a>
  <ul class="collapse">
  <li><a href="#harvesting-cells" id="toc-harvesting-cells" class="nav-link" data-scroll-target="#harvesting-cells">3.1 Harvesting cells</a></li>
  <li><a href="#washing-and-counting" id="toc-washing-and-counting" class="nav-link" data-scroll-target="#washing-and-counting">3.2 Washing and counting</a></li>
  </ul></li>
  <li><a href="#step-4-resuspension-in-nucleofector-solution-and-mixing-with-rnp" id="toc-step-4-resuspension-in-nucleofector-solution-and-mixing-with-rnp" class="nav-link" data-scroll-target="#step-4-resuspension-in-nucleofector-solution-and-mixing-with-rnp">Step 4 – Resuspension in nucleofector solution and mixing with RNP</a>
  <ul class="collapse">
  <li><a href="#preparation-of-nucleofector-cell-suspension" id="toc-preparation-of-nucleofector-cell-suspension" class="nav-link" data-scroll-target="#preparation-of-nucleofector-cell-suspension">4.1 Preparation of nucleofector cell suspension</a></li>
  <li><a href="#mixing-cells-with-rnp" id="toc-mixing-cells-with-rnp" class="nav-link" data-scroll-target="#mixing-cells-with-rnp">4.2 Mixing cells with RNP</a></li>
  </ul></li>
  <li><a href="#step-5-loading-nucleocuvette-and-running-the-4d-program" id="toc-step-5-loading-nucleocuvette-and-running-the-4d-program" class="nav-link" data-scroll-target="#step-5-loading-nucleocuvette-and-running-the-4d-program">Step 5 – Loading Nucleocuvette™ and running the 4D program</a>
  <ul class="collapse">
  <li><a href="#loading-nucleocuvette-strips" id="toc-loading-nucleocuvette-strips" class="nav-link" data-scroll-target="#loading-nucleocuvette-strips">5.1 Loading Nucleocuvette™ strips</a></li>
  <li><a href="#selecting-and-running-programs" id="toc-selecting-and-running-programs" class="nav-link" data-scroll-target="#selecting-and-running-programs">5.2 Selecting and running programs</a></li>
  </ul></li>
  <li><a href="#step-6-immediate-post-nucleofection-rescue" id="toc-step-6-immediate-post-nucleofection-rescue" class="nav-link" data-scroll-target="#step-6-immediate-post-nucleofection-rescue">Step 6 – Immediate post-nucleofection rescue</a>
  <ul class="collapse">
  <li><a href="#addition-of-rescue-medium-in-cuvette" id="toc-addition-of-rescue-medium-in-cuvette" class="nav-link" data-scroll-target="#addition-of-rescue-medium-in-cuvette">6.1 Addition of rescue medium in cuvette</a></li>
  <li><a href="#transfer-to-culture-plates" id="toc-transfer-to-culture-plates" class="nav-link" data-scroll-target="#transfer-to-culture-plates">6.2 Transfer to culture plates</a></li>
  </ul></li>
  <li><a href="#step-7-recommended-timelines-for-analysis" id="toc-step-7-recommended-timelines-for-analysis" class="nav-link" data-scroll-target="#step-7-recommended-timelines-for-analysis">Step 7 – Recommended timelines for analysis</a></li>
  </ul></li>
  <li><a href="#materials" id="toc-materials" class="nav-link" data-scroll-target="#materials">Materials</a>
  <ul class="collapse">
  <li><a href="#reagents" id="toc-reagents" class="nav-link" data-scroll-target="#reagents">Reagents</a></li>
  <li><a href="#disposables" id="toc-disposables" class="nav-link" data-scroll-target="#disposables">Disposables</a></li>
  <li><a href="#equipment" id="toc-equipment" class="nav-link" data-scroll-target="#equipment">Equipment</a></li>
  </ul></li>
  <li><a href="#buffers-used" id="toc-buffers-used" class="nav-link" data-scroll-target="#buffers-used">Buffers used</a></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a></li>
  <li><a href="#safety-brief" id="toc-safety-brief" class="nav-link" data-scroll-target="#safety-brief">Safety (brief)</a></li>
  <li><a href="#version-history" id="toc-version-history" class="nav-link" data-scroll-target="#version-history">Version history</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="prot_gen_lymphocyte_nucleofection.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">4D-Nucleofector CRISPR–Cas9 RNP Delivery to T and NK Cells</h1>
<p class="subtitle lead">Abdullah Lab, IMMEI, University Hospital Bonn</p>
</div>

<div>
  <div class="description">
    Unified 4D-Nucleofector protocol for CRISPR–Cas9 RNP delivery into primary mouse T cells, primary mouse NK cells, human CD8 T cells, and NK-92 cells using cell-type–specific buffer and pulse codes.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><strong>Protocol ID:</strong> GEN-LYMPH-NUC-001<br>
<strong>Version:</strong> v1.0<br>
<strong>Author:</strong> Dillon Corvino</p>
<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>This protocol provides a unified workflow for CRISPR–Cas9 ribonucleoprotein (RNP) delivery into T and NK cells using the Lonza 4D-Nucleofector system with 20 µL Nucleocuvette™ strips. It harmonises RNP preparation, cell handling, nucleofection, and recovery steps across:</p>
<ul>
<li>Primary mouse CD8 T cells (naïve and activated)<br>
</li>
<li>Primary mouse NK cells (activated)<br>
</li>
<li>Human CD8 T cells (activated)<br>
</li>
<li>NK-92 cells</li>
</ul>
<p>Cell-type–specific parameters (nucleofection buffer, pulse program, and recommended RNP load) are summarised in a lookup table.</p>
</section>
<section id="critical-notes-read-before-starting" class="level1">
<h1>Critical notes (read before starting)</h1>
<ul>
<li>This protocol is specific to the <strong>4D-Nucleofector X unit with 20 µL Nucleocuvette™ strips</strong>.</li>
<li>Always use the <strong>cell-type–specific buffer and pulse code</strong> from the lookup table; do not interchange programs between cell types without re-optimisation.</li>
<li>Nucleofector solutions (P3, P4, SE) are <strong>toxic</strong> to cells; minimise exposure time and handle rapidly once cells are resuspended.</li>
<li>Residual culture medium or serum will impair nucleofection efficiency; remove supernatants completely after the final PBS/DPBS wash.</li>
<li>Assemble RNP at a defined gRNA:Cas9 molar ratio (2–3:1) and incubate <strong>15 min at 37 °C</strong> before mixing with cells.</li>
<li>Use <strong>pre-warmed rescue medium</strong> and allow cells to recover in the cuvette for 10–25 min after nucleofection before transfer to culture plates.</li>
<li>Perform all steps under appropriate biosafety conditions (typically BSL2), as cells and reagents may be of human origin.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not leave cells in nucleofector solution for extended periods. Prepare RNP, wash cells, resuspend in buffer, mix, load cuvette, and pulse within a tightly controlled time window to preserve viability.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Prepare a simple “nucleofection map” for each run, listing wells/strips, cell types, buffers, programs, gRNAs, and replicates. This reduces labelling errors and simplifies downstream analysis.</p>
</div>
</div>
</section>
<section id="approximate-timing" class="level1">
<h1>Approximate timing</h1>
<ul>
<li>RNP preparation and incubation: 20–30 min<br>
</li>
<li>Cell harvest and washing: 30–60 min (depending on source and activation protocol)<br>
</li>
<li>Nucleofection (loading strips and pulsing): 15–30 min<br>
</li>
<li>Post-nucleofection recovery and transfer to culture: 30–45 min</li>
</ul>
<p><strong>Total hands-on time (per run):</strong> ~2–3 hours (excluding prior activation and downstream readouts).</p>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</section>
<section id="procedure" class="level1">
<h1>Procedure</h1>
<section id="step-1-cell-typespecific-lookup" class="level2">
<h2 class="anchored" data-anchor-id="step-1-cell-typespecific-lookup">Step 1 – Cell-type–specific lookup</h2>
<p>Use the table below to select the appropriate <strong>buffer</strong>, <strong>4D-Nucleofector program</strong>, and starting <strong>RNP load</strong> for each cell type. All reactions use <strong>20 µL total nucleofection volume</strong> in 20 µL Nucleocuvette™ strips.</p>
<section id="cell-typespecific-nucleofection-settings" class="level3">
<h3 class="anchored" data-anchor-id="cell-typespecific-nucleofection-settings">1.1 Cell-type–specific nucleofection settings</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Cell type</th>
<th>Activation state</th>
<th>Buffer (solution)</th>
<th>Program</th>
<th>Cells per reaction (20 µL)</th>
<th>Suggested gRNA per reaction¹</th>
<th>Suggested Cas9 per reaction¹</th>
<th>Post-nucleofection cytokines (examples)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mouse CD8 T (naïve)</td>
<td>IL-7, no TCR stimulation</td>
<td>P4</td>
<td>DS-137</td>
<td>1.0 × 10⁶</td>
<td>~150 pmol</td>
<td>~60 pmol</td>
<td>IL-7 (e.g.&nbsp;5–10 ng/mL)</td>
</tr>
<tr class="even">
<td>Mouse CD8 T (activated)</td>
<td>TCR/peptide stimulated</td>
<td>P4</td>
<td>CM-137</td>
<td>1.0 × 10⁶</td>
<td>~150 pmol</td>
<td>~60 pmol</td>
<td>IL-2 ± IL-7 (lab-specific)</td>
</tr>
<tr class="odd">
<td>Mouse NK (primary)</td>
<td>Pre-activated (e.g.&nbsp;NK1.1 + IL-15/IL-2)</td>
<td>P3 or P4²</td>
<td>EN-138</td>
<td>0.5–1.0 × 10⁶</td>
<td>~150 pmol</td>
<td>~60 pmol</td>
<td>IL-15 + IL-2 (as per NK culture SOP)</td>
</tr>
<tr class="even">
<td>Human CD8 T (activated)</td>
<td>TCR/anti-CD3/CD28, IL-2</td>
<td>P3</td>
<td>EH-115</td>
<td>1.0 × 10⁶</td>
<td>~120–150 pmol</td>
<td>~60 pmol</td>
<td>IL-2 (e.g.&nbsp;100–200 IU/mL)</td>
</tr>
<tr class="odd">
<td>NK-92</td>
<td>NK-92 medium, log-phase</td>
<td>SE</td>
<td>CM-137</td>
<td>0.5–1.0 × 10⁶</td>
<td>~150–180 pmol</td>
<td>~60 pmol</td>
<td>IL-2 as per NK-92 culture SOP (if used)</td>
</tr>
</tbody>
</table>
<p>¹Values are per 20 µL reaction and are starting points based on existing optimisation; adjust per guide, locus, and experimental needs.<br>
²If both P3 and P4 have been tested for mouse NK, use the solution that gave the best balance of viability and editing in your prior experiments.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This unified protocol describes a common workflow. Cell-type–specific pre-activation (e.g.&nbsp;NK priming, T-cell stimulation) and culture conditions should be followed according to the relevant cell culture SOPs and are not exhaustively detailed here.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-2-grna-duplex-and-rnp-preparation" class="level2">
<h2 class="anchored" data-anchor-id="step-2-grna-duplex-and-rnp-preparation">Step 2 – gRNA duplex and RNP preparation</h2>
<p>This section assumes use of <strong>crRNA + tracrRNA</strong> duplexes and recombinant Cas9 protein.</p>
<section id="crrnatracrrna-duplexing" class="level3">
<h3 class="anchored" data-anchor-id="crrnatracrrna-duplexing">2.1 crRNA:tracrRNA duplexing</h3>
<ol type="1">
<li>Thaw crRNA and tracrRNA aliquots on ice.<br>
</li>
<li>Mix crRNA and tracrRNA at <strong>equimolar concentrations</strong> (e.g.&nbsp;each at 100 µM) to generate a duplex:
<ul>
<li>Example: 5 µL crRNA (100 µM) + 5 µL tracrRNA (100 µM) → 10 µL duplex at 100 µM.</li>
</ul></li>
<li>Incubate at <strong>95 °C for 5 min</strong>, then allow to cool to room temperature (bench-top) for at least 10 min, or follow vendor instructions.</li>
<li>Store duplexed gRNA on ice during RNP preparation.</li>
</ol>
</section>
<section id="rnp-assembly" class="level3">
<h3 class="anchored" data-anchor-id="rnp-assembly">2.2 RNP assembly</h3>
<ol type="1">
<li><p>Thaw Cas9 protein aliquots on ice.<br>
</p></li>
<li><p>For each nucleofection reaction, prepare RNP mix in a low-bind tube:</p>
<ul>
<li>Example per reaction (starting point, adjust using Table 1):
<ul>
<li>1.5 µL gRNA duplex (100 µM) → 150 pmol gRNA<br>
</li>
<li>3.0 µL Cas9 (20 µM) → 60 pmol Cas9<br>
</li>
<li>Optional: add nuclease-free water to increase handling volume, if needed.</li>
</ul></li>
</ul></li>
<li><p>Gently mix by pipetting; avoid bubbles.<br>
</p></li>
<li><p>Incubate the RNP mix at <strong>37 °C for 15 min</strong>.<br>
</p></li>
<li><p>After incubation, keep RNP at room temperature or on ice and use within <strong>1–2 hours</strong> for nucleofection.</p></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not repeatedly freeze–thaw Cas9 or gRNA aliquots. Prepare small working aliquots and discard thawed leftovers at the end of the day to preserve activity.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-3-cell-preparation" class="level2">
<h2 class="anchored" data-anchor-id="step-3-cell-preparation">Step 3 – Cell preparation</h2>
<p>The steps below describe the unified handling for all T and NK cell types. Follow cell-type–specific culture SOPs for prior expansion and activation.</p>
<section id="harvesting-cells" class="level3">
<h3 class="anchored" data-anchor-id="harvesting-cells">3.1 Harvesting cells</h3>
<ol type="1">
<li>Harvest cells from culture flasks or plates at the desired time point (e.g.&nbsp;2–3 days post activation for T cells; 3 days post priming for NK).<br>
</li>
<li>For suspension cultures (mouse NK, NK-92, activated T cells): gently resuspend by pipetting up and down.<br>
</li>
<li>For mixed cultures (e.g.&nbsp;mouse spleen-derived T or NK), process according to the relevant isolation SOP (e.g.&nbsp;magnetic separation) before nucleofection.</li>
</ol>
</section>
<section id="washing-and-counting" class="level3">
<h3 class="anchored" data-anchor-id="washing-and-counting">3.2 Washing and counting</h3>
<ol type="1">
<li>Transfer cells to 15 mL conical tubes.<br>
</li>
<li>Centrifuge at <strong>300–400 g for 5 min</strong> at room temperature.<br>
</li>
<li>Carefully aspirate supernatant.<br>
</li>
<li>Resuspend the pellet in <strong>10 mL</strong> DPBS or PBS and mix gently.<br>
</li>
<li>Centrifuge again under the same conditions.<br>
</li>
<li>Aspirate the supernatant completely.<br>
</li>
<li>Take an aliquot and count cells (e.g.&nbsp;trypan blue exclusion).<br>
</li>
<li>Calculate total cell number and plan <strong>0.5–1.0 × 10⁶ cells per nucleofection reaction</strong>.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Residual serum or culture medium in the pellet will reduce nucleofection efficiency and viability. After the final wash, remove supernatant carefully and completely before adding nucleofector solution.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-4-resuspension-in-nucleofector-solution-and-mixing-with-rnp" class="level2">
<h2 class="anchored" data-anchor-id="step-4-resuspension-in-nucleofector-solution-and-mixing-with-rnp">Step 4 – Resuspension in nucleofector solution and mixing with RNP</h2>
<section id="preparation-of-nucleofector-cell-suspension" class="level3">
<h3 class="anchored" data-anchor-id="preparation-of-nucleofector-cell-suspension">4.1 Preparation of nucleofector cell suspension</h3>
<ol type="1">
<li><p>Pre-equilibrate nucleofector solutions (P3, P4, SE) to <strong>room temperature</strong> as recommended by the manufacturer.<br>
</p></li>
<li><p>For each cell type, prepare enough nucleofector solution for all planned reactions, following the kit instructions (e.g.&nbsp;supplementing solution with additive as required).<br>
</p></li>
<li><p>Resuspend washed cells in the appropriate nucleofector solution at a concentration of:</p>
<ul>
<li><strong>5 × 10⁷ cells/mL</strong> for 1.0 × 10⁶ cells in 20 µL<br>
</li>
<li><strong>2.5 × 10⁷ cells/mL</strong> for 0.5 × 10⁶ cells in 20 µL</li>
</ul></li>
<li><p>Gently mix and keep at room temperature. Avoid leaving cells in nucleofector solution for longer than <strong>15–20 min</strong> before pulsing.</p></li>
</ol>
</section>
<section id="mixing-cells-with-rnp" class="level3">
<h3 class="anchored" data-anchor-id="mixing-cells-with-rnp">4.2 Mixing cells with RNP</h3>
<p>For each reaction:</p>
<ol type="1">
<li>Aliquot the appropriate volume of RNP mix into a fresh low-bind tube or directly into the well/strip position (e.g.&nbsp;4.5 µL per reaction).<br>
</li>
<li>Add nucleofector cell suspension to reach a <strong>total volume of 20 µL per reaction</strong>:
<ul>
<li>Example: 4.5 µL RNP + 15.5 µL cell suspension.<br>
</li>
</ul></li>
<li>Gently pipette up and down to mix; avoid introducing air bubbles.<br>
</li>
<li>Immediately proceed to loading the Nucleocuvette™.</li>
</ol>
<hr>
</section>
</section>
<section id="step-5-loading-nucleocuvette-and-running-the-4d-program" class="level2">
<h2 class="anchored" data-anchor-id="step-5-loading-nucleocuvette-and-running-the-4d-program">Step 5 – Loading Nucleocuvette™ and running the 4D program</h2>
<section id="loading-nucleocuvette-strips" class="level3">
<h3 class="anchored" data-anchor-id="loading-nucleocuvette-strips">5.1 Loading Nucleocuvette™ strips</h3>
<ol type="1">
<li>Place the 20 µL Nucleocuvette™ strip into its holder.<br>
</li>
<li>Carefully pipette <strong>20 µL</strong> of the RNP–cell mix into each well, aiming the pipette tip to the side of the well to minimise bubbles.<br>
</li>
<li>Visually inspect each well for uniform filling and absence of air pockets.<br>
</li>
<li>Insert the holder into the 4D-Nucleofector X unit.</li>
</ol>
</section>
<section id="selecting-and-running-programs" class="level3">
<h3 class="anchored" data-anchor-id="selecting-and-running-programs">5.2 Selecting and running programs</h3>
<ol type="1">
<li>On the 4D-Nucleofector control unit, select the <strong>nucleofection program</strong> corresponding to the cell type (see lookup table in Step 1).<br>
</li>
<li>Confirm that the selected program and kit (P3, P4, SE) match the cells in the strip.<br>
</li>
<li>Start the nucleofection run.<br>
</li>
<li>When complete, remove the Nucleocuvette™ strip promptly and place it in a biosafety cabinet.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If running multiple cell types in parallel, clearly separate strips by cell type and program to avoid mismatches. Only one program can be used per strip/run.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-6-immediate-post-nucleofection-rescue" class="level2">
<h2 class="anchored" data-anchor-id="step-6-immediate-post-nucleofection-rescue">Step 6 – Immediate post-nucleofection rescue</h2>
<section id="addition-of-rescue-medium-in-cuvette" class="level3">
<h3 class="anchored" data-anchor-id="addition-of-rescue-medium-in-cuvette">6.1 Addition of rescue medium in cuvette</h3>
<ol type="1">
<li>Immediately after nucleofection, add <strong>60–100 µL</strong> of <strong>pre-warmed culture medium</strong> directly into each Nucleocuvette™ well:
<ul>
<li>Use the appropriate base medium (e.g.&nbsp;T-cell medium, NK medium, or NK-92 medium).<br>
</li>
<li>Cytokines may be omitted from this initial rescue step if preferred (see cell-type notes below).</li>
</ul></li>
<li>Gently pipette up and down once to mix, without generating bubbles.<br>
</li>
<li>Place the Nucleocuvette™ strip into a 37 °C incubator (inside a sterile container) or keep at 37 °C in the biosafety cabinet if feasible.</li>
<li>Allow cells to recover in the cuvette for <strong>10–25 min</strong>.</li>
</ol>
</section>
<section id="transfer-to-culture-plates" class="level3">
<h3 class="anchored" data-anchor-id="transfer-to-culture-plates">6.2 Transfer to culture plates</h3>
<ol type="1">
<li><p>After the recovery period, gently resuspend each Nucleocuvette™ well by pipetting up and down.<br>
</p></li>
<li><p>Transfer the entire volume (typically 80–120 µL) into the corresponding well of a pre-warmed 96- or 48-well plate or into a culture tube containing:</p>
<ul>
<li><strong>Final volume</strong>: 200–1000 µL per well/tube.<br>
</li>
<li><strong>Appropriate cytokine supplementation</strong>, for example:
<ul>
<li>Naïve mouse T: IL-7 ± low IL-2.<br>
</li>
<li>Activated T (mouse/human): IL-2 ± IL-7.<br>
</li>
<li>Mouse NK: IL-15 + IL-2 as per NK culture SOP.<br>
</li>
<li>NK-92: NK-92 medium ± IL-2 as per NK-92 culture SOP.</li>
</ul></li>
</ul></li>
<li><p>Adjust final cell density to <strong>0.5–1.0 × 10⁶ cells/mL</strong> for standard culture.<br>
</p></li>
<li><p>Incubate plates at <strong>37 °C, 5% CO₂</strong>.</p></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not leave nucleofected cells in undiluted nucleofector buffer longer than necessary. Rescue medium should be added within minutes after the pulse and cells should be transferred to standard culture conditions within 30–40 min.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-7-recommended-timelines-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="step-7-recommended-timelines-for-analysis">Step 7 – Recommended timelines for analysis</h2>
<p>Although the exact timepoint will depend on the target locus and downstream readouts, the following windows are commonly used:</p>
<ul>
<li><strong>Mouse NK cells:</strong> assess viability and KO efficiency at <strong>day 3</strong> and <strong>day 7</strong>.<br>
</li>
<li><strong>Mouse T cells (naïve/activated):</strong> assess between <strong>day 3–6</strong>, with extended phenotyping up to <strong>day 10–15</strong> when needed.<br>
</li>
<li><strong>Human T cells (activated):</strong> assess at <strong>day 3–5</strong> post nucleofection.<br>
</li>
<li><strong>NK-92:</strong> assess between <strong>day 3–5</strong> post nucleofection.</li>
</ul>
<p>Choice of timepoint should balance maximal editing efficiency with sufficient recovery and expansion.</p>
<hr>
</section>
</section>
<section id="materials" class="level1">
<h1>Materials</h1>
<section id="reagents" class="level2">
<h2 class="anchored" data-anchor-id="reagents">Reagents</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 14%">
<col style="width: 6%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Reagent</th>
<th>Supplier</th>
<th>Cat. #</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4D-Nucleofector™ X Unit + 20 µL Nucleocuvette™ strips</td>
<td>Lonza</td>
<td>—</td>
<td>Core instrument and plasticware</td>
</tr>
<tr class="even">
<td>Nucleofector™ P3 Primary Cell kit</td>
<td>Lonza</td>
<td>—</td>
<td>For mouse NK (option), human activated T cells</td>
</tr>
<tr class="odd">
<td>Nucleofector™ P4 Primary Cell kit</td>
<td>Lonza</td>
<td>—</td>
<td>For mouse CD8 T cells (naïve and activated), mouse NK (option)</td>
</tr>
<tr class="even">
<td>Nucleofector™ SE Cell Line kit</td>
<td>Lonza</td>
<td>—</td>
<td>For NK-92 cells</td>
</tr>
<tr class="odd">
<td>crRNA and tracrRNA (or sgRNA)</td>
<td>IDT / similar</td>
<td>—</td>
<td>Target-specific; duplexed prior to RNP assembly</td>
</tr>
<tr class="even">
<td>Cas9 nuclease (recombinant)</td>
<td>IDT / similar</td>
<td>—</td>
<td>High-purity Cas9 for RNP formation</td>
</tr>
<tr class="odd">
<td>DPBS / PBS, 1×</td>
<td>Various</td>
<td>—</td>
<td>For washing cells before nucleofection</td>
</tr>
<tr class="even">
<td>T-cell culture medium</td>
<td>In-house / various</td>
<td>—</td>
<td>e.g.&nbsp;RPMI + 10% FCS + Pen/Strep + supplements</td>
</tr>
<tr class="odd">
<td>NK culture medium</td>
<td>In-house / various</td>
<td>—</td>
<td>e.g.&nbsp;NK medium (BUF-MUS-NK-MED-001)</td>
</tr>
<tr class="even">
<td>NK-92 culture medium</td>
<td>In-house / various</td>
<td>—</td>
<td>Defined NK-92 medium formulation</td>
</tr>
<tr class="odd">
<td>Recombinant cytokines (IL-7, IL-2, IL-15)</td>
<td>PeproTech / similar</td>
<td>—</td>
<td>For pre-activation and post-nucleofection culture</td>
</tr>
<tr class="even">
<td>Trypan blue or viability dye</td>
<td>Various</td>
<td>—</td>
<td>For viability and counting</td>
</tr>
</tbody>
</table>
</section>
<section id="disposables" class="level2">
<h2 class="anchored" data-anchor-id="disposables">Disposables</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 46%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Item</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>15 mL and 50 mL tubes</td>
<td>Sterile, conical</td>
</tr>
<tr class="even">
<td>96-well or 48-well culture plates</td>
<td>Tissue culture-treated</td>
</tr>
<tr class="odd">
<td>Low-bind microcentrifuge tubes</td>
<td>For RNP assembly</td>
</tr>
<tr class="even">
<td>Serological pipettes (5–25 mL)</td>
<td>Sterile</td>
</tr>
<tr class="odd">
<td>Pipette tips (10–1000 µL)</td>
<td>Sterile, filter tips recommended</td>
</tr>
<tr class="even">
<td>Reservoirs for media and buffers</td>
<td>Sterile</td>
</tr>
</tbody>
</table>
</section>
<section id="equipment" class="level2">
<h2 class="anchored" data-anchor-id="equipment">Equipment</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 46%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Equipment</th>
<th>Specification / Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4D-Nucleofector™ X Unit</td>
<td>With 20 µL Nucleocuvette™ strips</td>
</tr>
<tr class="even">
<td>Biological safety cabinet</td>
<td>Class II, for sterile and safe handling</td>
</tr>
<tr class="odd">
<td>CO₂ incubator</td>
<td>37 °C, 5% CO₂</td>
</tr>
<tr class="even">
<td>Benchtop centrifuge</td>
<td>For 15/50 mL tubes (300–400 g)</td>
</tr>
<tr class="odd">
<td>Water bath</td>
<td>37 °C, for reaction and thawing</td>
</tr>
<tr class="even">
<td>Cell counter or hemocytometer</td>
<td>For counting and viability assessment</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="buffers-used" class="level1">
<h1>Buffers used</h1>
<ul>
<li><strong>Nucleofection buffers (Lonza kits):</strong>
<ul>
<li>P3 Primary Cell kit – solution + supplement<br>
</li>
<li>P4 Primary Cell kit – solution + supplement<br>
</li>
<li>SE Cell Line kit – solution + supplement</li>
</ul></li>
<li><strong>Culture media and specialised buffers:</strong>
<ul>
<li>T-cell medium (e.g.&nbsp;RPMI + 10% FCS + Pen/Strep + supplements)<br>
</li>
<li>NK medium (e.g.&nbsp;BUF-MUS-NK-MED-001)<br>
</li>
<li>NK-92 medium (cell-line–specific formulation)<br>
</li>
<li>DPBS/PBS, 1× (for washes)</li>
</ul></li>
</ul>
</section>
<section id="troubleshooting" class="level1">
<h1>Troubleshooting</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 32%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Problem</th>
<th>Possible cause</th>
<th>Suggested solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Low viability after nucleofection</td>
<td>Prolonged exposure to P3/P4/SE; incorrect program</td>
<td>Shorten handling time in nucleofector solution; verify program; reduce cell density per reaction</td>
</tr>
<tr class="even">
<td>Poor editing efficiency (low KO)</td>
<td>Insufficient gRNA/Cas9; residual serum; incorrect guide</td>
<td>Increase gRNA (within range); ensure complete washes; verify guide design</td>
</tr>
<tr class="odd">
<td>High variability between replicates</td>
<td>Uneven cell counts; pipetting error in RNP addition</td>
<td>Standardise counting; use multichannel pipettes or master mixes where possible</td>
</tr>
<tr class="even">
<td>Clumping after nucleofection</td>
<td>High cell density; inadequate resuspension</td>
<td>Reduce cells per reaction; gently resuspend and filter if necessary</td>
</tr>
<tr class="odd">
<td>Delayed recovery or poor proliferation</td>
<td>Inadequate cytokine support; suboptimal post-nucleofection density</td>
<td>Optimise cytokine cocktail; adjust seeding density; ensure fresh medium</td>
</tr>
<tr class="even">
<td>Apparent toxicity of RNP mix</td>
<td>Old or degraded Cas9/gRNA; repeated freeze–thaw cycles</td>
<td>Use fresh aliquots; avoid refreezing; check storage conditions</td>
</tr>
</tbody>
</table>
</section>
<section id="safety-brief" class="level1">
<h1>Safety (brief)</h1>
<ul>
<li>Handle all primary cells and cell lines, especially human-derived material, under <strong>BSL2</strong> conditions according to institutional guidelines.</li>
<li>Wear appropriate PPE (lab coat, gloves, eye protection) throughout the procedure.</li>
<li>Dispose of cell culture waste, nucleofection strips, and contaminated plastics as biohazardous waste.</li>
<li>Follow manufacturer safety data sheets (SDS) for nucleofector solutions, Cas9, and any chemical reagents used.</li>
</ul>
</section>
<section id="version-history" class="level1">
<h1>Version history</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v1.0</td>
<td>2025-11-21</td>
<td>Dillon Corvino</td>
<td>First unified 4D-Nucleofector protocol for T and NK cell CRISPR–Cas9 RNP.</td>
</tr>
</tbody>
</table>



</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>