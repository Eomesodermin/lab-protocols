<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-11-26">
<meta name="description" content="Isolation of viable mouse liver single-cell suspensions for downstream flow cytometry, sorting, and single-cell applications.">

<title>Mouse Liver Digestion to Single-Cell Suspension – Protocol Library</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-167a4993dfeda6e8ce52aaf90a3aabf8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Protocol Library
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Protocol Library</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true"><i class="bi bi-person-check" role="img">
</i> 
 <span class="menu-text">Onboarding</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Onboarding overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Onboarding checklist</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/contacts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key contacts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/training/data_and_reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data and reproducibility</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Lab information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/lab_info/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab information overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/lab_info/lab_expectations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab expectations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/lab_info/lab_etiquette.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab etiquette</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/lab_info/communication_norms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication norms</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Institute information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/institute/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Institute overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/institute/institute_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Institute overview page</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/institute/research_groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research groups</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/onboarding/institute/core_facilities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core facilities</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/buffers/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-droplet" role="img">
</i> 
 <span class="menu-text">Buffers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/general/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-gear" role="img">
</i> 
 <span class="menu-text">General</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/human/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-person" role="img">
</i> 
 <span class="menu-text">Human</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/mouse/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-mouse" role="img">
</i> 
 <span class="menu-text">Mouse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/resources/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-link-45deg" role="img">
</i> 
 <span class="menu-text">Resources</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../protocols_src/templates/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-spreadsheet" role="img">
</i> 
 <span class="menu-text">Templates</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a></li>
  <li><a href="#critical-notes-read-before-starting" id="toc-critical-notes-read-before-starting" class="nav-link" data-scroll-target="#critical-notes-read-before-starting">Critical notes (read before starting)</a></li>
  <li><a href="#approximate-timing" id="toc-approximate-timing" class="nav-link" data-scroll-target="#approximate-timing">Approximate timing</a></li>
  <li><a href="#procedure" id="toc-procedure" class="nav-link" data-scroll-target="#procedure">Procedure</a>
  <ul class="collapse">
  <li><a href="#step-1-preparation-and-setup" id="toc-step-1-preparation-and-setup" class="nav-link" data-scroll-target="#step-1-preparation-and-setup">STEP 1 – Preparation and setup</a></li>
  <li><a href="#step-2-liver-harvest-and-perfusion" id="toc-step-2-liver-harvest-and-perfusion" class="nav-link" data-scroll-target="#step-2-liver-harvest-and-perfusion">STEP 2 – Liver harvest and perfusion</a></li>
  <li><a href="#step-3-liver-collection-weighing-and-mincing" id="toc-step-3-liver-collection-weighing-and-mincing" class="nav-link" data-scroll-target="#step-3-liver-collection-weighing-and-mincing">STEP 3 – Liver collection, weighing, and mincing</a></li>
  <li><a href="#step-4-enzymatic-and-mechanical-dissociation" id="toc-step-4-enzymatic-and-mechanical-dissociation" class="nav-link" data-scroll-target="#step-4-enzymatic-and-mechanical-dissociation">STEP 4 – enzymatic and mechanical dissociation</a>
  <ul class="collapse">
  <li><a href="#option-a---gentlemacs-c-tube" id="toc-option-a---gentlemacs-c-tube" class="nav-link" data-scroll-target="#option-a---gentlemacs-c-tube">Option A - GentleMACS C-tube</a></li>
  <li><a href="#option-b-manual-mechanical-dissociation" id="toc-option-b-manual-mechanical-dissociation" class="nav-link" data-scroll-target="#option-b-manual-mechanical-dissociation">Option B – Manual mechanical dissociation</a></li>
  </ul></li>
  <li><a href="#step-5-hepatocyte-removal-and-washing" id="toc-step-5-hepatocyte-removal-and-washing" class="nav-link" data-scroll-target="#step-5-hepatocyte-removal-and-washing">STEP 5 – Hepatocyte removal and washing</a></li>
  <li><a href="#step-6-37-percoll-enrichment" id="toc-step-6-37-percoll-enrichment" class="nav-link" data-scroll-target="#step-6-37-percoll-enrichment">STEP 6 – 37% Percoll enrichment</a></li>
  <li><a href="#step-7-rbc-lysis" id="toc-step-7-rbc-lysis" class="nav-link" data-scroll-target="#step-7-rbc-lysis">STEP 7 – RBC lysis</a></li>
  <li><a href="#step-8-final-resuspension" id="toc-step-8-final-resuspension" class="nav-link" data-scroll-target="#step-8-final-resuspension">STEP 8 – Final resuspension</a></li>
  </ul></li>
  <li><a href="#materials" id="toc-materials" class="nav-link" data-scroll-target="#materials">Materials</a>
  <ul class="collapse">
  <li><a href="#reagents" id="toc-reagents" class="nav-link" data-scroll-target="#reagents">Reagents</a></li>
  <li><a href="#disposables" id="toc-disposables" class="nav-link" data-scroll-target="#disposables">Disposables</a></li>
  <li><a href="#equipment" id="toc-equipment" class="nav-link" data-scroll-target="#equipment">Equipment</a></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a></li>
  <li><a href="#safety-brief" id="toc-safety-brief" class="nav-link" data-scroll-target="#safety-brief">Safety (brief)</a></li>
  <li><a href="#version-history" id="toc-version-history" class="nav-link" data-scroll-target="#version-history">Version history</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="prot_mus_liver_digestion.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mouse Liver Digestion to Single-Cell Suspension</h1>
<p class="subtitle lead">Abdullah Lab, IMMEI, University Hospital Bonn</p>
</div>

<div>
  <div class="description">
    Isolation of viable mouse liver single-cell suspensions for downstream flow cytometry, sorting, and single-cell applications.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 26, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><strong>Protocol ID:</strong> MUS-LIV-DIG-001<br>
<strong>Version:</strong> v1.2<br>
<strong>Author:</strong> Dillon Corvino</p>
<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>This protocol describes the preparation of single-cell suspensions from mouse liver using perfusion, enzymatic digestion, mechanical dissociation, density centrifugation, and RBC lysis. The resulting cell suspension is suitable for downstream applications such as flow cytometry, FACS sorting, and single-cell omics workflows (with appropriate QC).</p>
</section>
<section id="critical-notes-read-before-starting" class="level1">
<h1>Critical notes (read before starting)</h1>
<ul>
<li>Keep all <strong>post-digestion washes cold</strong> (4 °C) where possible to preserve viability.</li>
<li>Process <strong>one liver per 70 µm strainer</strong>; do not reuse strainers between livers.</li>
<li>Liver cell pellets are often <strong>loose</strong>; be careful when pouring supernatants.</li>
<li>Do not over-digest; limit digestion to <strong>30 minutes at 37 °C</strong> with agitation.</li>
<li>Percoll must be at <strong>room temperature</strong> and properly diluted to <strong>37%</strong> immediately before use.</li>
<li>Ensure RBC lysis is <strong>time-limited (2-5 minutes)</strong> to avoid damaging leukocytes.</li>
</ul>
</section>
<section id="approximate-timing" class="level1">
<h1>Approximate timing</h1>
<ul>
<li>Preparation and setup: <strong>10–15 min</strong></li>
<li>Mouse euthanasia, perfusion, and liver dissection: <strong>5–10 min per mouse</strong></li>
<li>Liver mincing and transfer into digestion buffer: <strong>5 min per mouse</strong></li>
<li>Enzymatic digestion (including gentleMACS where applicable): <strong>30–40 min</strong></li>
<li>Mechanical dissociation, hepatocyte removal, and washes: <strong>20–30 min</strong></li>
<li>Percoll gradient centrifugation and leukocyte enrichment: <strong>25–30 min</strong></li>
<li>RBC lysis (if required), filtration, and final resuspension: <strong>15–20 min</strong></li>
</ul>
<p><strong>Total approximate time:</strong> <strong>~2–2.5 hours for 1–4 livers processed in parallel</strong><br>
(Effective hands-on time per liver is ~60–90 minutes, depending on batching and operator experience.)</p>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</section>
<section id="procedure" class="level1">
<h1>Procedure</h1>
<section id="step-1-preparation-and-setup" class="level2">
<h2 class="anchored" data-anchor-id="step-1-preparation-and-setup">STEP 1 – Preparation and setup</h2>
<ol type="1">
<li><strong>Pre-cool collection solutions</strong>
<ul>
<li>Pre-cool <strong>PBS or FACS buffer</strong> on ice for liver perfusion and tissue collection.</li>
</ul></li>
<li><strong>Label collection vessels (choose one option per experiment)</strong>
<ul>
<li><strong>Option A: 6-well plate collection</strong>
<ul>
<li>Label one well per mouse in a 6-well plate.</li>
<li>Add <strong>3–5 mL ice-cold PBS or FACS buffer</strong> per well.</li>
</ul></li>
<li><strong>Option B: 50 mL tube collection</strong>
<ul>
<li>Label one <strong>50 mL conical tube per liver</strong>.</li>
<li>Add <strong>5 mL ice-cold PBS or FACS buffer</strong> per tube.</li>
</ul></li>
</ul></li>
<li><strong>Label dissociation and processing tubes</strong>
<ul>
<li>Label <strong>gentleMACS C-tubes</strong> (or equivalent) for each liver.</li>
<li>Label additional <strong>50 mL tubes</strong> as required for downstream processing steps.</li>
</ul></li>
<li><strong>Prepare buffers</strong>
<ul>
<li><strong>Liver digestion buffer</strong>.</li>
<li><strong>37% Percoll working solution</strong>.</li>
<li><strong>ACK lysis buffer</strong>, if required.</li>
<li><strong>FACS buffer</strong> for washes and final resuspension.</li>
</ul></li>
<li><strong>Warm digestion components</strong>
<ul>
<li>Pre-warm a water bath to <strong>37 °C</strong>.</li>
<li>Place an aliquot of <strong>liver digestion buffer</strong> in the water bath to equilibrate.</li>
<li>If digestion buffer will be prepared immediately before use, pre-warm <strong>DMEM</strong> instead.</li>
</ul></li>
<li><strong>Equipment setup</strong>
<ul>
<li>Pre-cool a benchtop centrifuge to <strong>4 °C</strong>.</li>
<li>Ensure access to a <strong>gentleMACS</strong> instrument with an appropriate liver dissociation program.</li>
</ul></li>
<li><strong>Items to take to the animal facility</strong>
<ul>
<li>Ice bucket with ice-cold <strong>PBS or FACS buffer</strong>.</li>
<li>6-well plates <em>and/or</em> pre-filled <strong>50 mL tubes</strong> (as selected above).</li>
<li>Sterile scissors and forceps.</li>
<li><strong>10 mL syringes</strong> (one per mouse or per treatment group).</li>
<li>Needles for liver perfusion (<strong>25G or 26G recommended</strong>).</li>
<li>Absorbent pads and a waste container for perfusion runoff.</li>
</ul></li>
</ol>
</section>
<section id="step-2-liver-harvest-and-perfusion" class="level2">
<h2 class="anchored" data-anchor-id="step-2-liver-harvest-and-perfusion">STEP 2 – Liver harvest and perfusion</h2>
<ol type="1">
<li>Euthanise the mouse according to institutional and ethical guidelines (e.g.&nbsp;<strong>CO₂ asphyxiation</strong> or other approved method).</li>
<li>Place the mouse in a supine position and perform a midline incision to open the abdominal cavity.</li>
<li>Expose the liver and major vessels (<strong>Inferior vena cava and portal vein</strong>).</li>
<li>Load a <strong>5 mL syringe</strong> with <strong>ice-cold FACS buffer</strong> and attach a <strong>25–27 G needle</strong>.</li>
<li>Perfuse the liver via one of the following routes:
<ul>
<li><strong>Inferior vena cava</strong> (preferred)<br>
</li>
<li><strong>Portal vein</strong></li>
<li><strong>Directly via the heart</strong></li>
</ul></li>
<li>Slowly perfuse with <strong>~5–10 mL FACS buffer per mouse</strong> until the liver visibly blanches.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Efficient perfusion reduces blood content and improves hepatocyte removal, density separation, and downstream staining quality.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Handle needles and sharps carefully and dispose of them immediately into an approved sharps container after perfusion.</p>
</div>
</div>
<ol start="7" type="1">
<li>Excise the liver carefully, <strong>removing the gallbladder</strong>.</li>
<li>Place the liver briefly on <strong>filter paper</strong> to blot excess buffer.</li>
</ol>
</section>
<section id="step-3-liver-collection-weighing-and-mincing" class="level2">
<h2 class="anchored" data-anchor-id="step-3-liver-collection-weighing-and-mincing">STEP 3 – Liver collection, weighing, and mincing</h2>
<ol type="1">
<li>Transfer the perfused liver to a <strong>pre-labelled collection vessel</strong> (on ice).</li>
<li><em>(Recommended)</em> <strong>Weigh the liver</strong>:
<ul>
<li>Briefly blot on filter paper to remove excess liquid.</li>
<li>Record the liver weight.</li>
</ul></li>
</ol>
</section>
<section id="step-4-enzymatic-and-mechanical-dissociation" class="level2">
<h2 class="anchored" data-anchor-id="step-4-enzymatic-and-mechanical-dissociation">STEP 4 – enzymatic and mechanical dissociation</h2>
<section id="option-a---gentlemacs-c-tube" class="level3">
<h3 class="anchored" data-anchor-id="option-a---gentlemacs-c-tube">Option A - GentleMACS C-tube</h3>
<ol type="1">
<li>Add <strong>5 mL pre-warmed liver digestion buffer (with DNAse)</strong> to a <strong>labelled gentleMACS C-tube</strong>.</li>
<li>Transfer the liver into the gentleMACS C-tube.</li>
<li>Using sterile scissors, mince the liver <strong>directly in the C-tube</strong> until fragments are approximately <strong>2–3 mm</strong> in size.</li>
<li>Ensure all tissue pieces are fully submerged in digestion buffer and not stuck to the tube walls.</li>
<li>Secure the C-tube onto the <strong>gentleMACS instrument</strong> and place the warming sleeve over the tube.</li>
<li>Run the appropriate <strong>liver digestion program</strong> (e.g.&nbsp;<strong>HH17</strong>, ~17 min).</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Confirm that each C-tube is correctly seated and rotating before leaving the instrument.<br>
If a tube is not spinning, stop the run, reseat the tube, and restart the program.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do <strong>not</strong> leave livers in digestion buffer beyond the programmed digestion time.<br>
Over-digestion can strip surface epitopes and negatively impact downstream phenotyping.<br>
Note: the gentleMACS instrument does <strong>not</strong> beep when the program finishes—set a timer before starting.</p>
</div>
</div>
<ol start="7" type="1">
<li>After completion of the program, transfer the entire liver cell suspension into a <strong>50 mL conical tube</strong>.</li>
<li>Rinse the C-tube with <strong>ice-cold FACS buffer</strong> and add the rinse to the same 50 mL tube to maximise yield.</li>
<li>Bring the total volume to <strong>50 mL with ice-cold FACS buffer</strong>.</li>
</ol>
<p>Proceed directly to <strong>STEP 5 – Hepatocyte removal and washing</strong>.</p>
</section>
<section id="option-b-manual-mechanical-dissociation" class="level3">
<h3 class="anchored" data-anchor-id="option-b-manual-mechanical-dissociation">Option B – Manual mechanical dissociation</h3>
<ol type="1">
<li>Add <strong>5 mL pre-warmed liver digestion buffer (with DNAse)</strong> to a <strong>labelled 50 mL tube</strong>.</li>
<li>Transfer the liver into the 50 mL tube.</li>
<li>Using sterile scissors, mince the liver <strong>directly in the tube</strong> until fragments are approximately <strong>2–3 mm</strong> in size.</li>
<li>Ensure all tissue pieces are fully submerged in digestion buffer and not adhered to the tube walls.</li>
<li>Place the tube horizontally on a <strong>37°C shaking incubator (250 rpm)</strong> and incubate for <strong>30 minutes</strong>.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ensure tubes are tightly closed and positioned securely on the shaker.<br>
Set a timer — prolonged digestion can reduce viability and affect surface marker integrity.</p>
</div>
</div>
<ol start="6" type="1">
<li>After incubation, place a <strong>70 μm cell strainer</strong> into a clean petri dish.</li>
<li>Pour the digestion mixture through the strainer.</li>
<li>Using the back of a <strong>5 mL syringe plunger</strong>, gently press the tissue through the strainer to mechanically dissociate remaining fragments.</li>
<li>Rinse the strainer with <strong>2% FCS in PBS/DPBS</strong> while continuing gentle mechanical disruption until no visible fragments remain.</li>
<li>Pour the single-cell suspension from the petri dish back into the corresponding <strong>50 mL tube</strong>.</li>
</ol>
<p>To maximise recovery:</p>
<ol start="11" type="1">
<li>Add <strong>5–10 mL 2% FCS.PBS</strong> into the petri dish.</li>
<li>Dab the underside of the strainer in the buffer to release trapped cells.</li>
<li>Rinse the syringe plunger in the same buffer to wash off adherent cells.</li>
<li>Use a transfer pipette to collect remaining suspension from the underside of the strainer and plunger and add to the corresponding <strong>50 mL tube</strong>.</li>
<li>Swirl the buffer in the petri dish to wash out residual cells and pour into the same tube.</li>
<li>Bring the volume to <strong>50 mL with ice-cold FACS buffer</strong>.</li>
</ol>
<p>Proceed directly to <strong>STEP 5 – Hepatocyte removal and washing</strong>.</p>
</section>
</section>
<section id="step-5-hepatocyte-removal-and-washing" class="level2">
<h2 class="anchored" data-anchor-id="step-5-hepatocyte-removal-and-washing">STEP 5 – Hepatocyte removal and washing</h2>
<ol type="1">
<li>Centrifuge at <strong>50 g for 2 minutes at 4 °C</strong> to sediment hepatocytes.</li>
<li>Carefully transfer the <strong>supernatant</strong> (containing leukocytes) to a fresh <strong>50 mL tube</strong>, avoiding disturbance of the hepatocyte pellet.</li>
<li>Adjust the volume to <strong>50 mL with ice-cold FACS buffer</strong>.</li>
<li>Centrifuge at <strong>400 g for 5 minutes at 4 °C</strong>.</li>
<li>Discard the supernatant and keep the leukocyte pellet <strong>on ice</strong> for downstream processing.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cell pellets from digested liver are often <strong>loose and poorly compacted</strong>.<br>
When discarding supernatant by pouring, do so carefully. Avoid flicking, shaking, or abrupt movements.</p>
</div>
</div>
</section>
<section id="step-6-37-percoll-enrichment" class="level2">
<h2 class="anchored" data-anchor-id="step-6-37-percoll-enrichment">STEP 6 – 37% Percoll enrichment</h2>
<ol type="1">
<li>Aliquot <strong>10 mL of 37% Percoll</strong> into <strong>pre-labelled 15 mL conical tubes</strong> (one tube per liver).</li>
<li>Using a <strong>transfer pipette</strong>, resuspend the cell pellet using the small remaining <strong>dead volume</strong>.</li>
<li>Take up approximately <strong>1 mL of 37% Percoll</strong> from the corresponding 15 mL tube and use it to <strong>rinse the 50 mL tube</strong>, resuspending any remaining cells.</li>
<li>Transfer the resuspended cells into the corresponding <strong>15 mL tube</strong> containing <strong>10 mL 37% Percoll</strong>.</li>
<li>Repeat the rinse <strong>1–2 times</strong> with additional small volumes of Percoll (as needed) to recover all remaining cells from the 50 mL tube.</li>
<li>Cap the 15 mL tubes and <strong>invert gently 2–3 times</strong> to ensure an even cell suspension.</li>
<li>Centrifuge at <strong>800 g for 20 minutes at room temperature (20–22 °C)</strong> using:
<ul>
<li>Acceleration: <strong>moderate</strong> (e.g.&nbsp;<strong>acc 7</strong>)</li>
<li>Brake: <strong>minimal</strong> (e.g.&nbsp;<strong>br 1</strong>)</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Avoid high brake settings during Percoll centrifugation. Abrupt braking can disrupt the gradient and reduce lymphocyte enrichment.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not leave liver samples in Percoll longer than necessary. Prolonged exposure can reduce viability and negatively impact downstream applications. Plan spins and next steps in advance.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>After the Percoll spin, a debris/hepatocyte-rich layer typically remains in the supernatant, while an enriched leukocyte pellet forms at the bottom of the tube.</p>
</div>
</div>
<ol start="9" type="1">
<li>Carefully aspirate or pour off the supernatant in one smooth motion without disturbing the pellet.</li>
<li>Keep tubes inverted briefly and gently dab the rim on paper towel to wick residual Percoll (avoid touching or dislodging the pellet).</li>
<li>Resuspend the pellet in <strong>10–15 mL ice-cold FACS buffer</strong>.</li>
<li>Centrifuge at <strong>400 g for 5 minutes at 4 °C</strong>.</li>
<li>Discard the supernatant and keep the enriched leukocyte pellet <strong>on ice</strong> for downstream steps.</li>
</ol>
</section>
<section id="step-7-rbc-lysis" class="level2">
<h2 class="anchored" data-anchor-id="step-7-rbc-lysis">STEP 7 – RBC lysis</h2>
<ol type="1">
<li>Add <strong>RBC lysis buffer</strong> to the cell pellet (<strong>0.5–1 mL per liver</strong>):
<ul>
<li><strong>ACK lysis buffer:</strong> incubate for <strong>30–60 seconds at room temperature</strong>, <strong>or</strong><br>
</li>
<li><strong>HybriMax RBC Lysis Buffer:</strong> incubate for <strong>2–3 minutes at room temperature</strong>.<br>
</li>
</ul></li>
<li>Gently resuspend immediately to distribute the buffer evenly.<br>
</li>
<li>Quench the reaction by topping up to <strong>15 mL with FACS Buffer</strong>.</li>
<li>Pass the suspension through a 70 µm cell strainer into a fresh 50 mL tube kept on ice.</li>
<li>Rinse the strainer with an additional 5–10 mL FACS Buffer if needed to recover remaining cells.</li>
<li>Centrifuge at <strong>400 g for 5 minutes at 4 °C</strong>.</li>
<li>Discard the supernatant and keep the pellet on ice.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Liver leukocytes are particularly sensitive to over-lysis. Do not exceed the stated incubation times, especially after enzymatic digestion or Percoll separation.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>RBC lysis is often unnecessary for liver samples when a Percoll gradient is used. If lysis is required, HybriMax is generally preferred due to its gentler action compared to ACK.</p>
</div>
</div>
</section>
<section id="step-8-final-resuspension" class="level2">
<h2 class="anchored" data-anchor-id="step-8-final-resuspension">STEP 8 – Final resuspension</h2>
<ol type="1">
<li>Resuspend the cell pellet in 1-5 mL ice-cold FACS Buffer</li>
<li>Count cells and assess viability (e.g.&nbsp;trypan blue) as required.</li>
<li>Proceed with downstream applications (e.g.&nbsp;flow cytometry, sorting, or culture of NLCs).</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For single-cell sequencing applications, minimise the time from tissue harvest to final resuspension, keep samples on ice whenever possible after digestion, and consider additional debris/dead cell removal steps if yields permit.</p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="materials" class="level1">
<h1>Materials</h1>
<section id="reagents" class="level2">
<h2 class="anchored" data-anchor-id="reagents">Reagents</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 17%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Reagent</th>
<th>Supplier</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FACS buffer</td>
<td>In-house / various</td>
<td>Used for perfusion, washes, and final resuspension; kept cold</td>
</tr>
<tr class="even">
<td>Liver digestion buffer</td>
<td>In-house</td>
<td>DMEM-based; contains collagenase and DNase I; pre-warmed to 37 °C</td>
</tr>
<tr class="odd">
<td>Collagenase (e.g.&nbsp;Collagenase IV or D)</td>
<td>Various</td>
<td>Component of liver digestion buffer</td>
</tr>
<tr class="even">
<td>DNase I</td>
<td>Various</td>
<td>Component of liver digestion buffer</td>
</tr>
<tr class="odd">
<td>Percoll</td>
<td>Cytiva/GE or similar</td>
<td>Prepared as a <strong>37% working solution</strong> on day of use</td>
</tr>
<tr class="even">
<td>ACK lysis buffer</td>
<td>Commercial or in-house</td>
<td>Optional; for RBC removal if required</td>
</tr>
<tr class="odd">
<td>Fetal calf serum (FCS), heat-inactivated</td>
<td>Various</td>
<td>Component of FACS buffer</td>
</tr>
<tr class="even">
<td>EDTA</td>
<td>Various</td>
<td>Component of FACS buffer</td>
</tr>
<tr class="odd">
<td>CO₂ or approved euthanasia agent</td>
<td>Facility supply</td>
<td>For mouse sacrifice</td>
</tr>
</tbody>
</table>
</section>
<section id="disposables" class="level2">
<h2 class="anchored" data-anchor-id="disposables">Disposables</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 40%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th>Item</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50 mL conical tubes</td>
<td>Liver collection and processing</td>
</tr>
<tr class="even">
<td>15 mL conical tubes</td>
<td>Percoll enrichment (one per liver)</td>
</tr>
<tr class="odd">
<td>gentleMACS C-tubes (or equivalent)</td>
<td>Enzymatic and mechanical dissociation</td>
</tr>
<tr class="even">
<td>Sterile Petri dishes (10 cm)</td>
<td>Backup mincing / straining if required</td>
</tr>
<tr class="odd">
<td>70 µm cell strainers</td>
<td>Filtration of digested tissue</td>
</tr>
<tr class="even">
<td>Syringes (5–10 mL)</td>
<td>Liver perfusion</td>
</tr>
<tr class="odd">
<td>Needles (25–27 G)</td>
<td>Inferior vena cava or portal vein perfusion</td>
</tr>
<tr class="even">
<td>Transfer pipettes</td>
<td>Resuspension and Percoll transfer</td>
</tr>
<tr class="odd">
<td>Filter paper</td>
<td>Blotting liver prior to weighing</td>
</tr>
<tr class="even">
<td>Paper towels / bench wipes</td>
<td>Wicking supernatants after Percoll</td>
</tr>
<tr class="odd">
<td>Gloves and sharps container</td>
<td>Standard laboratory safety</td>
</tr>
</tbody>
</table>
</section>
<section id="equipment" class="level2">
<h2 class="anchored" data-anchor-id="equipment">Equipment</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 61%">
</colgroup>
<thead>
<tr class="header">
<th>Equipment</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CO₂ chamber or euthanasia setup</td>
<td>As per animal ethics approval</td>
</tr>
<tr class="even">
<td>Dissection instruments</td>
<td>Scissors and forceps</td>
</tr>
<tr class="odd">
<td>gentleMACS dissociator</td>
<td>With liver-appropriate digestion program</td>
</tr>
<tr class="even">
<td>Refrigerated centrifuge</td>
<td>Compatible with 15 mL and 50 mL tubes; adjustable brake</td>
</tr>
<tr class="odd">
<td>Benchtop incubator or heating sleeve</td>
<td>37 °C for enzymatic digestion</td>
</tr>
<tr class="even">
<td>Analytical balance</td>
<td>For weighing mice and livers</td>
</tr>
<tr class="odd">
<td>Biological safety cabinet (Class II)</td>
<td>Recommended for tissue and cell handling</td>
</tr>
<tr class="even">
<td>Ice bucket</td>
<td>To keep samples cold between steps</td>
</tr>
<tr class="odd">
<td>Timer</td>
<td>Critical for digestion, Percoll, and lysis steps</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="troubleshooting" class="level1">
<h1>Troubleshooting</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Problem</th>
<th>Possible cause</th>
<th>Suggested solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Low lymphocyte yield</td>
<td>Incomplete perfusion or digestion</td>
<td>Ensure liver blanches during perfusion; mince thoroughly; avoid under-digestion</td>
</tr>
<tr class="even">
<td>High red blood cell contamination</td>
<td>Insufficient or skipped RBC lysis</td>
<td>Perform brief ACK lysis (≤2 min) and quench immediately</td>
</tr>
<tr class="odd">
<td>Poor Percoll separation or weak pellet</td>
<td>Incorrect Percoll concentration or harsh braking</td>
<td>Use fresh <strong>37% Percoll</strong>; confirm centrifuge settings; minimise brake</td>
</tr>
<tr class="even">
<td>Loose pellets and cell loss</td>
<td>Aggressive pouring of supernatant</td>
<td>Pour slowly in one smooth motion; wick residual liquid gently</td>
</tr>
<tr class="odd">
<td>Low viability</td>
<td>Over-digestion or prolonged handling at RT</td>
<td>Limit digestion time; keep washes cold; process promptly</td>
</tr>
<tr class="even">
<td>Excess debris or clumping</td>
<td>Inadequate DNase activity or filtration</td>
<td>Confirm DNase in digestion buffer; filter through 70 µm mesh</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</section>
<section id="safety-brief" class="level1">
<h1>Safety (brief)</h1>
<ul>
<li>All animal procedures must comply with approved animal licences and institutional regulations.</li>
<li>Wear appropriate PPE (lab coat, gloves, eye protection) when handling animals, tissues, and reagents.</li>
<li>Handle sharps (needles, scalpels) with care and dispose of immediately in approved sharps containers.</li>
<li>Perform tissue and cell handling in a biological safety cabinet where appropriate.</li>
<li>Percoll and RBC lysis buffers are chemical hazards; avoid skin and eye contact and dispose of waste according to local safety guidelines.</li>
</ul>
</section>
<section id="version-history" class="level1">
<h1>Version history</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Version</th>
<th>Date</th>
<th>Author</th>
<th>Change summary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v1.0</td>
<td>2025-11-20</td>
<td>Dillon Corvino</td>
<td>Initial Quarto version based on SOP_001 (liver) from IEO</td>
</tr>
<tr class="even">
<td>v1.1</td>
<td>2025-11-26</td>
<td>Dillon Corvino</td>
<td>Manual check and update protocol</td>
</tr>
<tr class="odd">
<td>v1.2</td>
<td>2025-12-29</td>
<td>Dillon Corvino</td>
<td>Unified with Abdullah lab protocol</td>
</tr>
</tbody>
</table>



</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>